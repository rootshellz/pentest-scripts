#!/bin/bash

# dnsbruter.sh
# Version 1.0
# A DNS subdomain finder
# By: th3xer0

if [ -z "$1" ]
	then
		echo "DNS Subdomain Finder"
		echo "Usage: $0 DOMAIN <WORDLIST> <OUTFILE>"
		exit -1
	else
		DOMAIN=$1
fi


if [ -z "$2" ]
	then
		WORDLIST="/usr/share/golismero/wordlist/dns/subbrute_large.txt"
	else
		WORDLIST=$2
fi

if [ -z "$3" ]
	then
		OUTFILE="./$DOMAIN_dnsbruter_results.txt"
	else
		OUTFILE=$3
fi

echo "[.] Generating DNS Sub Domain List for: $DOMAIN"
echo "[.] Using wordlist: $WORDLIST"
echo "[.] Note: this may take some time depending on the size of the wordlist.  Go get some coffee."


echo "#1: Runnign nmap dns-brute script:"
nmap --script dns-brute --script-args dns-brute.domain=$DOMAIN,dns-brute.hostlist=$WORDLIST -oA $DOMAIN_nmap_dns-brute_results
cat $DOMAIN_nmap_dns-brute_results.nmap | grep "|" | grep $DOMAIN | grep -v "^|_" | cut -d " " -f 6 | sort | uniq >> $OUTFILE
cat $DOMAIN_nmap_dns-brute_results.nmap | grep "|" | grep $DOMAIN | grep "^|_" | cut -d " " -f 5 >> $OUTFILE

echo "#2: Running default dnsmap:"
dnsmap $DOMAIN -c $DOMAIN_dnsmap_default_results.csv
cat $DOMAIN_dnsmap_default_results.csv | cut -d "," -f 1 | sort | uniq >> $OUTFILE

echo "Deduping Results..."
START=$(cat $OUTFILE | wc -l)
cat $OUTFILE | sort | uniq > temp.txt && mv temp.txt $OUTFILE
COUNT=$(cat $OUTFILE | wc -l)
echo "Done: $COUNT unique subdomain found.\n\n"
