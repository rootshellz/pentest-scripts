#!/usr/bin/env bash

# dnsbruter.sh
# A DNS subdomain finder
# Usage: $0 <-w WORDLIST> <-o OUTFILE> DOMAIN
# Version 1.2
# By: th3xer0

while [[ $# -gt 1 ]]
	do
		key="$1"

		case $key in
			-w|--wordlist)
			WORDLIST="$2"
			shift
			;;
			-o|--outfile)
			OUTFILE="$2"
			shift
			;;
			*)
			;;
		esac
		shift
	done

if [ -z "$1" ]
	then
		echo "DNS Subdomain Finder"
		echo "Usage: $0 <-w WORDLIST> <-o OUTFILE> DOMAIN"
		exit -1
	else
		DOMAIN=$1
fi

if [ -z "$WORDLIST" ]
	then
		WORDLIST="/usr/share/golismero/wordlist/dns/subbrute_large.txt"
fi

if [ -z "$OUTFILE" ]
	then
		OUTFILE=$DOMAIN\_dnsbruter\_results.txt
fi

echo "[.] Generating DNS Sub Domain List for: $DOMAIN"
echo "[.] Using wordlist: $WORDLIST"
echo "[.] Saving to $OUTFILE"
echo "[.] Note: this may take some time depending on the size of the wordlist.  Go get some coffee."

echo "#1: Runnign nmap dns-brute script:"
nmap --script dns-brute --script-args dns-brute.domain=$DOMAIN,dns-brute.hostlist=$WORDLIST -oA $DOMAIN\_nmap\_dns\-brute\_results
cat $DOMAIN_nmap_dns-brute_results.nmap | grep "|" | grep $DOMAIN | grep -v "^|_" | cut -d " " -f 6 | sort | uniq >> $OUTFILE
cat $DOMAIN_nmap_dns-brute_results.nmap | grep "|" | grep $DOMAIN | grep "^|_" | cut -d " " -f 5 >> $OUTFILE

echo "#2: Running default dnsmap:"
dnsmap $DOMAIN -c $DOMAIN\_dnsmap\_default\_results.csv
cat $DOMAIN_dnsmap_default_results.csv | cut -d "," -f 1 | sort | uniq >> $OUTFILE

echo "Deduping Results..."
START=$(cat $OUTFILE | wc -l)
cat $OUTFILE | sort | uniq > temp.txt && mv temp.txt $OUTFILE
COUNT=$(cat $OUTFILE | wc -l)
echo "Done: $COUNT unique subdomain found.\n\n"
